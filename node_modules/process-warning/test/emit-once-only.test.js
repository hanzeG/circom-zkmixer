'use strict'

<<<<<<< HEAD
const test = require('tap').test
=======
const { test } = require('tap')
>>>>>>> 6f73ac31c9d17e6a3e9aa206e992f10f52f391ce
const build = require('..')

test('emit should emit a given code only once', t => {
  t.plan(4)

  const { create, emit, emitted } = build()

  process.on('warning', onWarning)
  function onWarning (warning) {
    t.equal(warning.name, 'FastifyDeprecation')
    t.equal(warning.code, 'CODE')
    t.equal(warning.message, 'Hello world')
    t.ok(emitted.get('CODE'))
  }

  create('FastifyDeprecation', 'CODE', 'Hello world')
  emit('CODE')
  emit('CODE')
  setImmediate(() => {
    process.removeListener('warning', onWarning)
    t.end()
  })
})
